# basis.data.dataset

Данное пространство имен описывает различные автоматические наборы. Данный вид наборов не управляет своим составом напрямую, а зависит от состава другого набора (или наборов) и некоторых заданных правил.

![Структура классов basis.data.dataset](img/data-datasets.png)

Автоматические наборы можно воспринимать как операции над множествами. Так `basis.data.dataset` экспортирует классы, которые позволяют совершать следующие операции:

  * [Merge](#merge) - объединение нескольких множеств в одно, по правилу (объединение, разность, дополнение и др);

  * [Subtract](#subtract) - вычитание одного множества из другого;

  * [Subset](#subset) - подмножество;

  * [Slice](#slice) - срез;

  * [Split](#split) - разбиение на подмножества 1:1 (группировка);

  * [Cloud](#cloud) - разбиение на подмножества 1:M;

## Merge

Данный класс агрегирует составы наборов-источников. Можно рассматривать `Merge` как объединение наборов.

Набор источников можно задать при создании, с помощью свойства `sources`, либо менять в дальнешем методами:

  * addSource(source) - добавить источник;

  * removeSource(source) - удалить источник;

  * setSources(sources) - задать новый нобор источников;

  * clear() - удалить все источники (очищает набор);


При изменении состава источников выбрасывается событие `sourcesChanged`. Данное событие аналогично `itemsChanged`, только в дельте хранятся добавленные и удаленные источники, а не элементы набора.

Правило (свойство `rule`) определяет, каким образом объединяются наборы. Правило получает два значения: `count` - количество вхождений объекта (в скольких источниках он присутствует), и `sourceCount` - количество источников. По умолчанию определены следующие правила:

  * basis.data.dataset.Merge.UNION – объединение, есть хотя бы в одном источнике;

  * basis.data.dataset.Merge.INTERSECTION – пересечение, есть во всех источниках;

  * basis.data.dataset.Merge.DIFFERENCE – разность, есть только в одном источнике;

  * basis.data.dataset.Merge.MORE_THAN_ONE_INCLUDE – не уникальное значение, есть в двух и более источниках;

  * basis.data.dataset.Merge.AT_LEAST_ONE_EXCLUDE – отсутствует хотя бы в одном источнике;

## Subtract

[TODO]

## SourceDataset

[TODO]

### Slice

[TODO]

### MapFilter

[TODO]

#### Subset

Класс-наследник `SourceDataset`, добавляет в свой состав только те элементы, для которых правило возвращает положительный результат (`true`).

Подразумевается что функция-правило проверяет данные объекта (свойство `data`) для вычисления результата, поэтому данный набор слушает изменения во всех объектах набор-источник и если происходят изменения пересчитывает результат. Таким образом, элементы автоматически добавляются или удаляются из набора, в зависимости от их данных.

Функция фильтр задается при создании через свойство `rule` или в дальнейшем с помощью метода `setRule`.

```js
var data = basis.data.wrap([1, 2, 3, 4, 5], true);

// создаем набор-источник (нужен для примера)
var dataSource = new basis.data.Dataset({
  items: data
});

// создаем подмножество
var subset = new basis.data.Subset({
  source: dataSource,    // задаем источник
  rule: function(item){  // правило
    return item.data.value % 2;
  }
});

function showItems(){
  subset.getItems().map(function(item){
    return item.data.value;
  });
}

console.log(showItems());
// > [1, 3, 5]

data[0].update({ value: 0 });
console.log(showItems());
// > [3, 5]

data[1].update({ value: 33 });
console.log(showItems());
// > [3, 5, 33]

dataSource.remove([data[0], data[1], data[2]]);
console.log(showItems());
// > [5]
```

#### Split

Другой класс-наследник `SourceDataset` - `Split`. Данный класс позволяет группировать элементы по результату функции-группировки (`rule`). При этом в составе данного набора оказываются наборы-группы, по которым распределяются элементы наборов-источников. Каждый элемент может находиться только в одной группе.

Функция группировки задается при создании через `rule` или в дальнейшем методом `setRule`. Эта функция должна возвращать некоторое значение, которое будет являться ключом группы или экземпляр `basis.data.Object`. Во втором случае, экземпляр будет делегатом набора-группы.

Когда функция группировки возвращает новое значение, то создается новый набор-группа. Его класс можно задать в `config.groupClass`, по умолчанию это `AbstractDataset`.

Набор слушает изменения в элементах источников и перемещает элемент из одной группы в другую, при необходимости.

#### Cloud

[TODO]
